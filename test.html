<!DOCTYPE html>
<html>
<head>
<title>房地产债券情况</title>
<meta charset="utf-8"/>
<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0" /> 
<link type="text/css" href="bootstrap/css/bootstrap.min.css" rel="stylesheet" />
<link type="text/css" href="jqgrid/css/ui.jqgrid-bootstrap.css" rel="stylesheet" />
<script type="text/javascript" src="bootstrap/js/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="jqgrid/js/jquery.jqGrid.min.js"></script>
<script type="text/javascript" src="js/sql-wasm.js"></script>
<style tyle="text/css">
.panel-default {margin-top: 5px;}
/*img{width:100%;}*/
</style>
</head>
<body>

    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <div class="panel panel-default">
                    <div class="panel-heading">股票列表</div>
                    <div class="panel-body">
                        <table id="tblStocks"></table>
                        <div id="pagiStocks"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        $(function() {

            config = {
                locateFile: filename => `js/${filename}`
            }

            initSqlJs(config).then(function(SQL){
                
                var xhr = new XMLHttpRequest();
                // For example: https://github.com/lerocha/chinook-database/raw/master/ChinookDatabase/DataSources/Chinook_Sqlite.sqlite
                xhr.open('GET', 'db/niceshot.db', true);
                xhr.responseType = 'arraybuffer';

                xhr.onload = e => {
                    var uInt8Array = new Uint8Array(xhr.response);
                    var db = new SQL.Database(uInt8Array);
                    var contents = db.exec("SELECT * FROM Data");
                    var values = contents[0].values;


                    var $grid = $("#tblStocks").jqGrid({
                    styleUI: 'Bootstrap',
                    datatype: "local",
                    //colNames:['ts_code','行业','名称', '涨幅720天', ],
                    colModel: [
                        { name: 'ts_code',  key: true, hidden: true, frozen: true },
                        { name: '行业',  width: 70,  frozen: true},
                        { name: '名称', width: 70,  frozen: true },
                        { name: '涨幅720天',  width: 60, formatter: function (cellValue, options, rowItem) {
                            if (cellValue == null) return "";
                            return (double.parse(cellValue)/100).toFixed(0)+'%';
                        } },
                        { name: '涨幅360天', width: 60, formatter: function (cellValue, options, rowItem) {
                            if (cellValue == null) return "";
                            return (double.parse(cellValue)/100).toFixed(0)+'%';
                        }  },
                        
                    ],
                    //autowidth: false,
                    autowidth: true,
                    //height:"365px",
                    //width: window.parent == window ? window.screen.availWidth - 20 : window.screen.availWidth - 250,
                    height: window.parent == window ? window.screen.availHeight - 20 : window.screen.availHeight - 20,
                    shrinkToFit: true,
                    viewrecords: true,
                    //searchGrid: {width:550},
                    //height: 880,
                    //multiselect: true,
                    //rowNum: 25,
                    //rowList: [25, 50,100],
                    //pager: "#pagiStocks",
                    //gridComplete: initGrid
                });

                    for(var i=0;i<values.length;i++){
                        var value = values[i];
                        var row = {
                            "ts_code":value[0],
                            "行业":value[1],
                            "名称":value[2],
                            "涨幅720天":value[3],
                        };
                        jQuery("#tblStocks").jqGrid('addRowData',i+1,row);
                        //console.log(value[1]+","+value[2]+","+value[3]+","+value[4]+",");
                    }
                    //colModel = $grid.jqGrid("getGridParam", "colModel");
                    //$grid.jqGrid("setLabel", colModel[0], "ts_code");

                };
                xhr.send();

            });

            
        });
    </script>

</body>
</html>